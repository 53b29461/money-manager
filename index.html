<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お金管理ツール</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>お金管理ツール</h1>
        
        <!-- 現在の資産額セクション -->
        <section class="current-assets-section">
            <h2>現在の資産額</h2>
            <div class="assets-form">
                <input type="number" id="currentAssets" placeholder="現在の資産額を入力">
                <button id="setAssetsBtn">資産額を設定</button>
            </div>
            <div class="assets-hint">
                <small>💡 銀行口座の残高など、現在持っている資産の総額を入力してください</small>
            </div>
            <div id="currentAssetsDisplay" class="assets-display" style="display: none;">
                <p><strong>設定済み初期資産額: </strong><span id="assetsAmount">-</span>円</p>
            </div>
        </section>
        
        <!-- 収入情報セクション -->
        <section class="income-section">
            <h2>収入管理</h2>
            
            <!-- 定期収入設定 -->
            <div class="regular-income-section">
                <h3 id="regularIncomeTitle">定期収入設定</h3>
                <div class="regular-income-form">
                    <input type="hidden" id="editingIncomeId" value="">
                    <div class="form-group">
                        <label for="regularIncomeStartDate">給料日</label>
                        <input type="date" id="regularIncomeStartDate">
                    </div>
                    <div class="form-group">
                        <label for="regularIncomeAmount">月収金額</label>
                        <input type="number" id="regularIncomeAmount" placeholder="例: 250000">
                    </div>
                    <div class="form-group">
                        <label for="regularIncomeMonths">何ヶ月分生成するか</label>
                        <input type="number" id="regularIncomeMonths" min="1" max="24" value="12">
                    </div>
                    <div class="form-buttons">
                        <button id="generateRegularIncomeBtn">定期収入を生成</button>
                        <button id="updateRegularIncomeBtn" style="display: none;">更新</button>
                        <button id="cancelEditIncomeBtn" style="display: none;">キャンセル</button>
                    </div>
                </div>
                <div class="income-hint">
                    <small>💡 年度変更（4月）や昇給時期に合わせて開始月を設定できます</small>
                </div>
                <div id="regularIncomeInfo"></div>
            </div>

            <!-- 個別収入追加 -->
            <div class="manual-income-section">
                <h3>個別収入追加</h3>
                <div class="income-form">
                    <input type="date" id="incomeDate" placeholder="収入日">
                    <input type="number" id="incomeAmount" placeholder="金額">
                    <button id="addIncomeBtn">収入を追加</button>
                </div>
            </div>

        </section>

        <!-- 支出管理セクション -->
        <section class="expense-section">
            <h2>支出管理</h2>
            
            <!-- 定期支出設定 -->
            <div class="regular-expense-section">
                <h3 id="regularExpenseTitle">定期支出設定</h3>
                <div class="regular-expense-form">
                    <input type="hidden" id="editingExpenseId" value="">
                    <div class="form-group">
                        <label for="regularExpenseStartDate">支出日</label>
                        <input type="date" id="regularExpenseStartDate">
                    </div>
                    <div class="form-group">
                        <label for="regularExpenseCategory">カテゴリ</label>
                        <select id="regularExpenseCategory">
                            <option value="food">食費</option>
                            <option value="communication">通信費</option>
                            <option value="clothing">服飾費</option>
                            <option value="utilities">光熱費</option>
                            <option value="subscription">サブスク費</option>
                            <option value="entertainment">交際費</option>
                            <option value="general">総支出</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="regularExpenseAmount">月額支出</label>
                        <input type="number" id="regularExpenseAmount" placeholder="例: 50000">
                    </div>
                    <div class="form-group">
                        <label for="regularExpenseMonths">何ヶ月分生成するか</label>
                        <input type="number" id="regularExpenseMonths" min="1" max="24" value="12">
                    </div>
                    <div class="form-buttons">
                        <button id="generateRegularExpenseBtn">定期支出を生成</button>
                        <button id="updateRegularExpenseBtn" style="display: none;">更新</button>
                        <button id="cancelEditExpenseBtn" style="display: none;">キャンセル</button>
                    </div>
                </div>
                <div class="expense-hint">
                    <small>💡 給料日と同じ日に支出が反映されます。カテゴリごとに設定してください。</small>
                </div>
                <div id="regularExpenseInfo"></div>
            </div>

            <!-- 個別支出追加 -->
            <div class="manual-expense-section">
                <h3>個別支出追加</h3>
                <div class="expense-form">
                    <input type="date" id="expenseDate" placeholder="支出日">
                    <select id="expenseCategory">
                        <option value="food">食費</option>
                        <option value="communication">通信費</option>
                        <option value="clothing">服飾費</option>
                        <option value="utilities">光熱費</option>
                        <option value="subscription">サブスク費</option>
                        <option value="entertainment">交際費</option>
                        <option value="general">総支出</option>
                        <option value="other">その他</option>
                    </select>
                    <input type="text" id="expenseDescription" placeholder="支出内容">
                    <input type="number" id="expenseAmount" placeholder="金額">
                    <button id="addExpenseBtn">支出を追加</button>
                </div>
            </div>
        </section>

        <!-- 統合収支履歴セクション -->
        <section class="transaction-history-section">
            <h2>収支履歴</h2>
            <div class="history-controls">
                <button id="toggleHistoryBtn" class="toggle-btn">
                    <span id="toggleHistoryIcon">▼</span> 履歴を表示
                </button>
                <button id="updateTransactionHistoryBtn" class="update-btn">更新</button>
                <div class="history-summary" id="historySummary"></div>
            </div>
            <div id="transactionHistory" class="transaction-list collapsed">
                <div class="pagination-controls" id="paginationControls">
                    <select id="itemsPerPage">
                        <option value="10">10件ずつ表示</option>
                        <option value="20" selected>20件ずつ表示</option>
                        <option value="50">50件ずつ表示</option>
                        <option value="100">100件ずつ表示</option>
                        <option value="all">すべて表示</option>
                    </select>
                    <div class="page-navigation">
                        <button id="prevPageBtn" class="page-btn">前へ</button>
                        <span id="pageInfo">1 / 1</span>
                        <button id="nextPageBtn" class="page-btn">次へ</button>
                    </div>
                </div>
                <div id="transactionContent"></div>
            </div>
        </section>

        <!-- 購入計画タイムラインセクション -->
        <section class="timeline-section">
            <h2>購入計画タイムライン</h2>
            <div class="timeline-input-section">
                <h3>欲しいもの追加</h3>
                <div class="wishlist-form">
                    <input type="text" id="itemName" placeholder="商品名">
                    <input type="number" id="itemPrice" placeholder="価格">
                    <button id="addItemBtn">追加</button>
                </div>
                <div class="timeline-hint">
                    <small>💡 アイテムは優先度順に購入され、ドラッグで順序を変更できます</small>
                </div>
            </div>
            <div id="timeline"></div>
        </section>

        <!-- 資産推移グラフセクション -->
        <section class="chart-section">
            <h2>資産推移グラフ</h2>
            <div class="chart-controls">
                <select id="chartPeriod">
                    <option value="3">3ヶ月</option>
                    <option value="6" selected>6ヶ月</option>
                    <option value="12">12ヶ月</option>
                    <option value="24">24ヶ月</option>
                </select>
                <button id="updateChartBtn">グラフ更新</button>
            </div>
            <div class="safety-line-section">
                <h3>セーフティーライン設定</h3>
                <div class="safety-line-form">
                    <input type="number" id="safetyLineAmount" placeholder="セーフティーライン金額">
                    <button id="setSafetyLineBtn">設定</button>
                    <button id="clearSafetyLineBtn">クリア</button>
                </div>
                <div class="safety-line-hint">
                    <small>💡 緊急資金の目安や心理的な安心ラインを設定できます</small>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="assetChart"></canvas>
            </div>
        </section>
    </div>

    <script src="script.js"></script>
</body>
</html>